{
    "collab_server" : "",
    "contents" : "\n\n---\ntitle: \"Healthcare Costs\"\nauthor: \"Jake Johnson, Travis Barrick, Erica Fitzgerald, Carrie Baggett\"\ndate: \"November 13, 2016\"\noutput: \n  ioslides_presentation:\n    fig_width: 7\n    fig_height: 9\n    widescreen: true\n    smaller: true\n\nruntime: shiny\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = FALSE,warning=FALSE)\n```\n\n```{r, echo=FALSE,message=FALSE, fig.height=5}\n#Libraries\nlibrary(readr)\nif (!require(shiny)) install.packages(\"shiny\")\nif (!require(ggplot2)) install.packages(\"ggplot2\")\nif (!require(dplyr)) install.packages(\"dplyr\")\nif (!require(plotly)) install.packages(\"plotly\")\nif (!require(leaflet)) install.packages(\"leaflet\")\nif (!require(htmltools)) install.packages(\"htmltools\")\nif (!require(DT)) install.packages(\"DT\")\nif (!require(stringr)) install.packages(\"stringr\")\nif (!require(ggmap)) install.packages(\"ggmap\")\nif (!require(devtools)) install.packages(\"devtools\")\nif (!require(ggthemes)) install.packages(\"ggthemes\")\nlibrary(shiny)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(leaflet)\nlibrary(htmltools)\nlibrary(DT)\nlibrary(stringr)\nlibrary(ggmap)\nlibrary(devtools)\ndevtools::install_github(\"ShinyRatingInput\", \"stefanwilhelm\")\nlibrary(ShinyRatingInput)\nlibrary(ggthemes)\n\n##### Data Import #####\nmapstates <- read_csv(\"mapstates3.csv\")\nmapstates2<-read_csv(\"mapstates4.csv\")\nAnalysis_Dataset <- read_csv(\"Analysis_Dataset2.csv\")\nAverageCategory <- read_csv(\"AverageCategory.csv\")\nstates<-map_data(\"state\")\n\n```\n##Cost of Healthcare\n-Bullet 1  \n-Bullet 2\n\n\n##Average Cost of Healthcare|By State\n\n```{r, echo=FALSE,message=FALSE,fig_width=13}\nui <- fluidPage(\n  sidebarLayout(\n    sidebarPanel(\n      selectInput(\"Category\", \"Select Category\", \n                  choices=c(\"Ears,Nose,Throat\",\t\"Endocrine\",\t\"Gastrointestinal\",\t\"Heart\",\t\"Infections\",\t\"Lung\",\t\"Nerve\",\t\"Orthopedic\",\t\"Other\",\t\"Poisoning\",\t\"Psychiatric\",\t\"Renal\",\t\"Skin\",\t\"Vascular\"\n                  ),\n                  selected=\"Infections\"\n                  ,\n                  multiple=FALSE), \n      selectInput(\"State\", \"Select States (To remove state, highlight and delete)\", \n                  choices=c(\"AK\"\t,\"AL\"\t,\"AR\"\t,\"AZ\"\t,\"CA\"\t,\"CO\"\t,\"CT\"\t,\"DC\"\t,\"DE\"\t,\"FL\"\t,\"GA\"\t,\"HI\"\t,\"IA\"\t,\"ID\"\t,\"IL\"\t,\"IN\"\t,\"KS\"\t,\"KY\"\t,\"LA\"\t,\"MA\"\t,\"MD\"\t,\"ME\"\t,\"MI\"\t,\"MN\"\t,\"MO\"\t,\"MS\"\t,\"MT\"\t,\"NC\"\t,\"ND\"\t,\"NE\"\t,\"NH\"\t,\"NJ\"\t,\"NM\"\t,\"NV\"\t,\"NY\"\t,\"OH\"\t,\"OK\"\t,\"OR\"\t,\"PA\"\t,\"RI\"\t,\"SC\"\t,\"SD\"\t,\"TN\"\t,\"TX\"\t,\"UT\"\t,\"VA\"\t,\"VT\"\t,\"WA\"\t,\"WI\"\t,\"WV\"\t,\"WY\"\n                  ),\n                  selected=c(\"AK\"\t,\"AL\"\t,\"AR\"\t,\"AZ\"\t,\"CA\"\t,\"CO\"\t,\"CT\"\t,\"DC\"\t,\"DE\"\t,\"FL\"\t,\"GA\"\t,\"HI\"\t,\"IA\"\t,\"ID\"\t,\"IL\"\t,\"IN\"\t,\"KS\"\t,\"KY\"\t,\"LA\"\t,\"MA\"\t,\"MD\"\t,\"ME\"\t,\"MI\"\t,\"MN\"\t,\"MO\"\t,\"MS\"\t,\"MT\"\t,\"NC\"\t,\"ND\"\t,\"NE\"\t,\"NH\"\t,\"NJ\"\t,\"NM\"\t,\"NV\"\t,\"NY\"\t,\"OH\"\t,\"OK\"\t,\"OR\"\t,\"PA\"\t,\"RI\"\t,\"SC\"\t,\"SD\"\t,\"TN\"\t,\"TX\"\t,\"UT\"\t,\"VA\"\t,\"VT\"\t,\"WA\"\t,\"WI\"\t,\"WV\"\t,\"WY\"\n                  ), \n                  multiple=TRUE)\n      ,width=3\n    ),\n    mainPanel(\n      plotlyOutput(\"plot\",width=\"100%\")\n    )\n  )\n)\n\nserver <- function(input, output,session) {\n  output$plot <- renderPlotly({\n    m<-Analysis_Dataset%>%\n      filter(Category==input$Category,ProviderState==input$State)%>%\n      group_by(Category,ProviderState) %>% \n      summarise(avg_insurance = paste(\"$\",prettyNum(mean(AverageCoveredCharges),big.mark=\",\",scientific=FALSE), sep=\"\"),\n                avg_medicare = paste(\"$\",prettyNum(mean(AverageMedicarePayments),big.mark=\",\",scientific=FALSE), sep=\"\") ,\n                avg_patient_owed = paste(\"$\",prettyNum(mean(AverageTotalPayments-AverageMedicarePayments),big.mark=\",\",scientific=FALSE), sep=\"\") )\n    \n    p <- plot_ly(m, x = ~avg_insurance, y = ~avg_medicare, \n                 z = ~avg_patient_owed,hoverinfo = 'text',text=~paste('Category: ',Category,'</br> State: ',ProviderState ,'</br> Average Insurance Cost: ',avg_insurance,'</br> Average Medicare Coverage: ',avg_medicare,'</br> Average Patient Owed: ',avg_patient_owed),color = ~Category \n    )%>%\n      add_markers() %>%\n      layout(scene = list(xaxis = list(title = 'Average Insurance'),\n                          yaxis = list(title = 'Average Medicare'),\n                          zaxis = list(title = 'Average Patient Owed')))\n    \n  })\n}\n\nshinyApp(ui = ui, server = server)\n```\n\n##Treatment Cost\n\n```{r, echo=FALSE,message=FALSE}\nui <- fluidPage(\n  # Application title\n  sidebarLayout(\n    sidebarPanel(\n      radioButtons(\"Category\", \"Select Category\", \n                  choices=c(\"Ears,Nose,Throat\",\t\"Endocrine\",\t\"Gastrointestinal\",\t\"Heart\",\t\"Infections\",\t\"Lung\",\t\"Nerve\",\t\"Orthopedic\",\t\"Other\",\t\"Poisoning\",\t\"Psychiatric\",\t\"Renal\",\t\"Skin\",\t\"Vascular\"\n                  ),\n                  selected=\"Heart\" \n                  ), \n      ratingInput(\"rating1\", label=\"Select Hospital Rating\",value=1),\n      width=4\n       ),\n    \n    # Show a plot of the generated distribution\n    mainPanel(tabsetPanel(\n      tabPanel(\"Map\",\n               leafletOutput('myMap')),\n      tabPanel(\"Most Affordable Hospitals\",\n               DT::dataTableOutput(\"table\"))\n    )\n    )\n  )\n)\n\n\n\n\nserver <- function(input, output,session) {\n  catreact<-reactive({input$Category})\n  ratingreact<-reactive({input$rating1})\n  \n  output$myMap <- renderLeaflet(\n    test<-AverageCategory%>%\n      filter(Category==catreact(), Rating >= ratingreact())%>%\n      group_by(Category)%>%\n      mutate(rank=row_number(),CostofTreatment=sprintf(\"$%s\",format(AverageCost,big.mark=\",\",digits=2,scientific=FALSE)))%>%\n      mutate(X=paste0('<strong>Provider Name: </strong>', \n                      ProviderName,\n                      '<br><strong>Address</strong>: ',\n                      ProviderStreetAddress,\n                      '<br><strong>City</strong>: ',\n                      ProviderCity,\n                      '<br><strong>Average Treatment Cost</strong>: ',\n                      CostofTreatment,\n                      '<br><strong>National Treatment Cost Rank</strong>: ',\n                      rank,\n                      '<br><strong>Overall Hospital Rating</strong>: ',\n                      Rating\n      ))%>%\n      leaflet()%>%\n      addProviderTiles(\"Esri.NatGeoWorldMap\")%>%\n      setView(-110, 45, zoom = 3)%>%\n      addMarkers(lng=~longitude, lat=~latitude,popup=~as.character(X),clusterOptions = markerClusterOptions())%>%\n      mapOptions(zoomToLimits = \"first\")\n  )\n  \n  output$table <- DT::renderDataTable(DT::datatable({\n    data <-     AverageCategory%>%\n      filter(Category==catreact(), Rating >= ratingreact())%>%\n      top_n(n=10,wt=AverageCost)%>%\n      mutate(CostofTreatment=sprintf(\"$%s\",format(AverageCost,big.mark=\",\",digits=2,scientific=FALSE)),State=Name)\n    \n    \n    data[,c(\"ProviderName\",\"ProviderCity\",\"State\",\"CostofTreatment\",\"Rating\")]\n    \n    \n  }))\n  output$rating <- renderText({paste(input$rating) })\n\n}\n\n# Run the application\nshinyApp(ui = ui, server = server)\n```\n\n##Cost of Healthcare Compared to Iowa\n\n```{r, echo=FALSE,message=FALSE}\nui <- fluidPage(\n  #titlePanel(\"Healthcare Expenses Compared to Iowa by Category\"),\n  \n  sidebarLayout(\n    sidebarPanel(\n      radioButtons(\"Category\", \"Select Category\", \n                  choices=c(\"Ears,Nose,Throat\",\t\"Endocrine\",\t\"Gastrointestinal\",\t\"Heart\",\t\"Infections\",\t\"Lung\",\t\"Nerve\",\t\"Orthopedic\",\t\"Other\",\t\"Poisoning\",\t\"Psychiatric\",\t\"Renal\",\t\"Skin\",\t\"Vascular\"\n                  ),\n                  selected=\"Heart\"\n                  ),width=3\n    ),\n    mainPanel(tabsetPanel(\n      tabPanel(\"% Difference to Iowa\",\n               plotlyOutput(\"plot2\",width=900,height=450\n               )),\n      tabPanel(\"Cost of Living Adjusted % Difference to Iowa\",\n               plotlyOutput(\"plot\",width=900,height=450\n               )))\n    )\n  )\n)  \n\n\nserver <- function(input, output,session) {\noutput$plot <- renderPlotly({\n    states<-map_data(\"state\")\n    \n    \n    catreact<-reactive({input$Category})\n    \n    mapstates %>% \n      filter(Category==catreact())%>%\n      group_by(Category,ProviderState,Mean_Cost_Percentage_Difference_to_Iowa)%>%\n      rename(Compared.to.Iowa=Mean_Cost_Percentage_Difference_to_Iowa)%>%\n      ggplot(aes(x = long, y = lat,group=group)) +   \n      geom_path()+\n      geom_polygon(aes(group = group, fill=Compared.to.Iowa))+\n      expand_limits(x=mapstates$long, y=mapstates$lat)+\n      scale_fill_gradient2(low=\"dark green\",mid=\"white\",high=\"dark red\",name=\"Cost of Living \\n% Compared to Iowa\")+\n      theme(plot.title = element_text(hjust = -0.7))+\n      ggthemes::theme_map()\n    \n  })\n  output$plot2 <- renderPlotly({\n  \n    \n    catreact<-reactive({input$Category})\n    mapstates2 %>% \n      filter(Category==catreact())%>%\n      group_by(Category,ProviderState,Mean_Cost_Percentage_Difference_to_Iowa)%>%\n      rename(Compared.to.Iowa=Mean_Cost_Percentage_Difference_to_Iowa)%>%\n      ggplot(aes(x = long, y = lat,group=group)) +   \n      geom_path()+\n      geom_polygon(aes(group = group, fill=Compared.to.Iowa))+\n      expand_limits(x=states$long, y=states$lat)+\n      scale_fill_gradient2(low=\"dark green\",mid=\"white\",high=\"dark red\",name=\"% Compared to Iowa\")+\n      theme(plot.title = element_text(hjust = -0.7))+\n      ggthemes::theme_map()\n    \n  })\n}\n\nshinyApp(ui = ui, server = server)\n```\n\n##Number of Patients by Category in Iowa\n\n\n```{r, echo=FALSE,message=FALSE}\nui <- fluidPage(\n  \n  \n    \n    mainPanel(\n      HTML(\"Hover over points for information\"),\n      selectInput(\"State\", \"Select States\", \n                  choices=c(\"AK\"\t,\"AL\"\t,\"AR\"\t,\"AZ\"\t,\"CA\"\t,\"CO\"\t,\"CT\"\t,\"DC\"\t,\"DE\"\t,\"FL\"\t,\"GA\"\t,\"HI\"\t,\"IA\"\t,\"ID\"\t,\"IL\"\t,\"IN\"\t,\"KS\"\t,\"KY\"\t,\"LA\"\t,\"MA\"\t,\"MD\"\t,\"ME\"\t,\"MI\"\t,\"MN\"\t,\"MO\"\t,\"MS\"\t,\"MT\"\t,\"NC\"\t,\"ND\"\t,\"NE\"\t,\"NH\"\t,\"NJ\"\t,\"NM\"\t,\"NV\"\t,\"NY\"\t,\"OH\"\t,\"OK\"\t,\"OR\"\t,\"PA\"\t,\"RI\"\t,\"SC\"\t,\"SD\"\t,\"TN\"\t,\"TX\"\t,\"UT\"\t,\"VA\"\t,\"VT\"\t,\"WA\"\t,\"WI\"\t,\"WV\"\t,\"WY\"\n                  ),\n                  selected=\"IA\", \n                  multiple=FALSE),\n       selectInput(\"Category\", \"Select Category\", \n                  choices=c(\"Ears,Nose,Throat\",\t\"Endocrine\",\t\"Gastrointestinal\",\t\"Heart\",\t\"Infections\",\t\"Lung\",\t\"Nerve\",\t\"Orthopedic\",\t\"Other\",\t\"Poisoning\",\t\"Psychiatric\",\t\"Renal\",\t\"Skin\",\t\"Vascular\"\n                  ),\n                  selected=\"Heart\",\n                  multiple=TRUE\n                  ),\n      # this is an extra div used ONLY to create positioned ancestor for tooltip\n      # we don't change its position\n     \n        plotlyOutput(\"scatterplot\"),\n     \n      width = 12\n    )\n  )\n\nserver <- function(input, output,session) {\n\n  \n  output$scatterplot <- renderPlotly({\n    m<-Analysis_Dataset %>%\n      filter(ProviderState==input$State,Category==input$Category)%>%\n      group_by(ProviderState,ProviderName,Category,Procedure) %>%\n      summarize(NumberofPatients = sum(TotalDischarges))\n    \n    gg<-ggplotly(ggplot(m,aes(Procedure,NumberofPatients,label=ProviderName))+\n      geom_point(aes(color=Category)) + \n      ylab(\"# of Patients\")+\n      coord_flip()+\n      guides(color=FALSE))\ngg\n  })\n  \n  \n\n}\nshinyApp(ui = ui, server = server)\n\n```\n",
    "created" : 1481231811972.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4282906054",
    "id" : "D38F3046",
    "lastKnownWriteTime" : 1481249866,
    "last_content_update" : 1481249866823,
    "path" : "C:/Users/Travis/Desktop/Final Project/Publish/Published.Rmd",
    "project_path" : "Publish/Published.Rmd",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}